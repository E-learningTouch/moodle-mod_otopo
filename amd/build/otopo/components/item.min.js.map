{"version":3,"file":"item.min.js","sources":["../../../src/otopo/components/item.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Otopo vue item.\n *\n * @copyright   2024 Nantes Universit√© <support-tice@univ-nantes.fr> (Commissioner)\n * @copyright   2024 E-learning Touch' <contact@elearningtouch.com> (Maintainer)\n * @copyright   2022 Kosmos <moodle@kosmos.fr> (Former maintainer)\n * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'mod_otopo/otopo/components/modal',\n    'mod_otopo/otopo/components/degrees',\n    'mod_otopo/otopo/ajax',\n    'mod_otopo/utils'\n], function(\n    ModalHelp,\n    Degrees,\n    ajax,\n    utils\n) {\n    return {\n        components: {\n            'ModalHelp': ModalHelp,\n            'Degrees': Degrees\n        },\n        props: {\n            item: {\n                type: Object\n            },\n            index: {\n                type: Number\n            }\n        },\n        methods: {\n            setUserOtopo() {\n                if (this.$root.$data.otopo === null) {\n                    // Must be preview. Ignore sending data.\n                    return;\n                }\n                ajax.setUserOtopo(\n                    this.$root.$data.otopo,\n                    this.$root.$data.session,\n                    this.item.id,\n                    this.degree,\n                    this.justification\n                );\n            },\n            degreeChanged(degree) {\n                this.degree = degree;\n                this.setUserOtopo();\n            }\n        },\n        data: function() {\n            return {\n                processChange: utils.debounce(() => this.setUserOtopo()),\n                strings: this.$root.$data.strings,\n                showModal: false,\n                degree: this.$root.$data.session && this.item.id in this.$root.$data.otopos ?\n                    this.$root.$data.otopos[this.item.id].degree : null,\n                justification: this.$root.$data.session && this.item.id in this.$root.$data.otopos ?\n                    this.$root.$data.otopos[this.item.id].justification : \"\",\n                comment: this.$root.$data.session && this.item.id in this.$root.$data.otopos ?\n                    this.$root.$data.otopos[this.item.id].comment : \"\",\n            };\n        },\n        computed: {\n            disabledDegree: function() {\n                if (!this.$root.$data.session) {\n                    return false;\n                }\n                return !this.$root.$data.active;\n            },\n            disabledJustification: function() {\n                if (!this.$root.$data.session) {\n                    return false;\n                }\n                return !this.$root.$data.active || !this.degree;\n            },\n            justificationHtml: function() {\n                var expression = /(https?:\\/\\/(?:www\\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\\.[^\\s]{2,}|www\\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\\.[^\\s]{2,}|https?:\\/\\/(?:www\\.|(?!www))[a-zA-Z0-9]+\\.[^\\s]{2,}|www\\.[a-zA-Z0-9]+\\.[^\\s]{2,})/gi; // eslint-disable-line max-len\n                var regex = new RegExp(expression);\n\n                return this.justification.replace(regex, '$1'.link('$1'));\n            },\n            commentHtml: function() {\n                if (!this.comment) {\n                    return this.strings.noteachercomment;\n                }\n\n                var expression = /(https?:\\/\\/(?:www\\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\\.[^\\s]{2,}|www\\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\\.[^\\s]{2,}|https?:\\/\\/(?:www\\.|(?!www))[a-zA-Z0-9]+\\.[^\\s]{2,}|www\\.[a-zA-Z0-9]+\\.[^\\s]{2,})/gi; // eslint-disable-line max-len\n                var regex = new RegExp(expression);\n\n                return this.comment.replace(regex, '$1'.link('$1'));\n            }\n        },\n        template: `\n            <div class=\"row mb-3\">\n                <div class=\"col-md-12 text-center\">\n                    <h4 class=\"font-weight-bold\" :style=\"'color:' + item.color + ';'\">{{ item.name }}</h4>\n                </div>\n                <div class=\"col-md-4\">\n                    <Degrees\n                        :degree=\"degree\"\n                        :itemName=\"item.name\"\n                        :color=\"item.color\"\n                        :degrees=\"item.degrees\" @changed=\"degreeChanged\"\n                        :disabled=\"disabledDegree\"\n                    />\n                </div>\n                <div :class=\"$root.$data.showComments ? 'col-md-4' : 'col-md-8'\">\n                    <div class=\"comment border rounded pt-1 pl-3 pr-3 mb-2 shadow-sm no-print\">\n                        <div class=\"input-group mb-3\">\n                            <textarea\n                                v-model=\"justification\"\n                                :disabled=\"disabledJustification\"\n                                class=\"form-control border-0\"\n                                :placeholder=\"strings.yourjustification\"\n                                @input=\"processChange()\"\n                                rows=\"5\"\n                            ></textarea>\n                        </div>\n                    </div>\n                    <div class=\"comment border rounded pt-1 pl-3 pr-3 mb-2 shadow-sm only-print\">\n                        <div class=\"input-group mb-3\">\n                            <p v-html=\"justificationHtml\"></p>\n                        </div>\n                    </div>\n                    <div class=\"d-flex justify-content-end\">\n                        <button id=\"show-help-modal\" class=\"bg-light rounded pl-2 pr-3 pt-1 pb-1 border shadow-sm\"\n                            @click=\"showModal = true\"\n                        >\n                            <i class=\"icon fa fa-question\" aria-hidden=\"true\"></i>\n                            {{ strings.help }}\n                        </button>\n                        <ModalHelp v-if=\"showModal\" @close=\"showModal = false\" />\n                    </div>\n                </div>\n                <div :class=\"$root.$data.showComments ? 'col-md-4' : 'd-none'\">\n                    <div class=\"comment border rounded pt-1 pl-3 pr-3 mb-2 shadow-sm\">\n                        <p v-html=\"commentHtml\"></p>\n                    </div>\n                </div>\n            </div>\n        `\n    };\n});\n"],"names":["define","ModalHelp","Degrees","ajax","utils","components","props","item","type","Object","index","Number","methods","setUserOtopo","this","$root","$data","otopo","session","id","degree","justification","degreeChanged","data","processChange","debounce","strings","showModal","otopos","comment","computed","disabledDegree","active","disabledJustification","justificationHtml","regex","RegExp","replace","link","commentHtml","noteachercomment","template"],"mappings":"AAuBAA,OAAM,kCAAC,CACH,mCACA,qCACA,uBACA,oBACD,SACCC,EACAC,EACAC,EACAC,GAEA,MAAO,CACHC,WAAY,CACRJ,UAAaA,EACbC,QAAWA,GAEfI,MAAO,CACHC,KAAM,CACFC,KAAMC,QAEVC,MAAO,CACHF,KAAMG,SAGdC,QAAS,CACLC,YAAAA,GACmC,OAA3BC,KAAKC,MAAMC,MAAMC,OAIrBd,EAAKU,aACDC,KAAKC,MAAMC,MAAMC,MACjBH,KAAKC,MAAMC,MAAME,QACjBJ,KAAKP,KAAKY,GACVL,KAAKM,OACLN,KAAKO,cAEb,EACAC,aAAAA,CAAcF,GACVN,KAAKM,OAASA,EACdN,KAAKD,cACT,GAEJU,KAAM,WACF,MAAO,CACHC,cAAepB,EAAMqB,UAAS,IAAMX,KAAKD,iBACzCa,QAASZ,KAAKC,MAAMC,MAAMU,QAC1BC,WAAW,EACXP,OAAQN,KAAKC,MAAMC,MAAME,SAAWJ,KAAKP,KAAKY,MAAUL,KAACC,MAAMC,MAAMY,OACjEd,KAAKC,MAAMC,MAAMY,OAAOd,KAAKP,KAAKY,IAAIC,OAAS,KACnDC,cAAeP,KAAKC,MAAMC,MAAME,SAAWJ,KAAKP,KAAKY,MAAUL,KAACC,MAAMC,MAAMY,OACxEd,KAAKC,MAAMC,MAAMY,OAAOd,KAAKP,KAAKY,IAAIE,cAAgB,GAC1DQ,QAASf,KAAKC,MAAMC,MAAME,SAAWJ,KAAKP,KAAKY,MAAML,KAAKC,MAAMC,MAAMY,OAClEd,KAAKC,MAAMC,MAAMY,OAAOd,KAAKP,KAAKY,IAAIU,QAAU,GAE5D,EACAC,SAAU,CACNC,eAAgB,WAAW,QAClBjB,KAAKC,MAAMC,MAAME,UAGdJ,KAAKC,MAAMC,MAAMgB,MAC7B,EACAC,sBAAuB,WACd,SAAAnB,KAAKC,MAAMC,MAAME,SAGdJ,KAAKC,MAAMC,MAAMgB,QAAWlB,KAAKM,OAC7C,EACAc,kBAAmB,WAEf,IAAIC,EAAQ,IAAIC,OADC,uNAGjB,YAAYf,cAAcgB,QAAQF,EAAO,KAAKG,KAAK,MACvD,EACAC,YAAa,WACT,IAAKzB,KAAKe,QACN,OAAWf,KAACY,QAAQc,iBAIxB,IAAIL,EAAQ,IAAIC,OADC,uNAGjB,YAAYP,QAAQQ,QAAQF,EAAO,KAAKG,KAAK,MACjD,GAEJG,SAAU,k8EAkDlB"}