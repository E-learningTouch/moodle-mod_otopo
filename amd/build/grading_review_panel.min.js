define("mod_otopo/grading_review_panel",["jquery","mod_assign/grading_events","core/notification","core/templates","core/str","core/chartjs"],(function(e,t,n,o,i,a){var s=function(t){this._regionSelector=t,this._region=e(t),this.registerEventListeners(),e(document).on("participant-loaded",this._refreshReviewPanel.bind(this)),i.get_strings([{key:"autoevaldegree",component:"otopo"}]).done((function(e){this._degreeStr=e[0]})).fail(n.exception),this._visual=this._region.data("otopovisual"),this._star=this._region.data("star"),this._starContainer=this._region.data("star-container"),this._help=this._region.data("help")};return s.prototype._regionSelector=null,s.prototype._region=null,s.prototype._visual="radar",s.prototype._degreeStr="",s.prototype._star="",s.prototype._starContainer="",s.prototype._help="",s.prototype._refreshReviewPanel=function(e,t){t.session.id?(t.star=this._star,t.help=this._help,t.starcontainer=this._starContainer,t.items.forEach((function(e){"otopodegreedescription"in e&&(e.otopodegreedescription=e.otopodegreedescription.replace(/\n/g,"<br />"))})),!t.sessionchart.label&&(t.sessionchart=null),o.render("mod_otopo/grading_review",t).done(function(e,n){this._region.fadeOut("fast",function(){let i;if(o.replaceNodeContents(this._region,e,n),"radar"==this._visual)i={scale:{ticks:{min:0,max:t.max,stepSize:1}},scales:{r:{beginAtZero:!0}}};else{const e={ticks:{beginAtZero:!0,min:0,max:t.max,stepSize:1,callbacks:function(e){return 0===e?"":this._degreeStr+" "+e}}},n={display:!1};t.moodlePre4?(i={scales:{yAxes:[e]}},i.legend=n):(i={scales:{y:e}},i.plugins={},i.plugins.legend=n)}t.moodlePre4?i.tooltips={displayColors:!1,callbacks:{title:function(e,t){return t.fullLabels[e[0].index]},label:function(e,t){let n=t.datasets[e.datasetIndex].data[e.index]||"0";return n+=t.datasets[e.datasetIndex].labels[e.index]?" - "+t.datasets[e.datasetIndex].labels[e.index]:"",n}}}:(!i.plugins&&(i.plugins={}),i.plugins.tooltip={displayColors:!1,callbacks:{title:function(e){return e.length>0&&e[0].label?e[0].label:null},label:function(e){if(e){let t=e.formattedValue||"0";return t+=e.dataset.labels[e.dataIndex]?" - "+e.dataset.labels[e.dataIndex]:"",t}return null}}});const s=document.getElementById("sessionChart");if(s&&t.sessionchart){const e={type:this._visual,data:t.sessionchart,options:i};new a(s,e)}this._region.fadeIn("fast")}.bind(this))}.bind(this)).fail(n.exception)):this._region.html("")},s.prototype.getTogglePanelButton=function(){return this.getPanelElement().find('[data-region="review-panel-toggle"]')},s.prototype.getPanelElement=function(){return e('[data-region="review-panel"]')},s.prototype.getPanelContentElement=function(){return e('[data-region="review-panel-content"]')},s.prototype.togglePanel=function(){this.getPanelElement().hasClass("collapsed")?e(document).trigger(t.EXPAND_REVIEW_PANEL):e(document).trigger(t.COLLAPSE_REVIEW_PANEL)},s.prototype.collapsePanel=function(){this.getPanelElement().addClass("collapsed").removeClass("grade-panel-collapsed"),this.getPanelContentElement().attr("aria-hidden",!0)},s.prototype.expandPanel=function(){this.getPanelElement().removeClass("collapsed"),this.getPanelContentElement().removeAttr("aria-hidden")},s.prototype.registerEventListeners=function(){var n=this.getTogglePanelButton();n.click(function(e){this.togglePanel(),e.preventDefault()}.bind(this)),n.keydown(function(e){!e.metaKey&&!e.shiftKey&&!e.altKey&&!e.ctrlKey&&(13===e.keyCode||32===e.keyCode)&&(this.togglePanel(),e.preventDefault())}.bind(this));var o=e(document);o.on(t.COLLAPSE_REVIEW_PANEL,function(){this.collapsePanel()}.bind(this)),o.on(t.COLLAPSE_GRADE_PANEL,function(){this.expandPanel(),this.getPanelElement().addClass("grade-panel-collapsed")}.bind(this)),o.on(t.EXPAND_REVIEW_PANEL,function(){this.expandPanel()}.bind(this)),o.on(t.EXPAND_GRADE_PANEL,function(){this.getPanelElement().removeClass("grade-panel-collapsed")}.bind(this))},s}));

//# sourceMappingURL=grading_review_panel.min.js.map