define("mod_otopo/evolution",["core/notification","core/templates","core/ajax","core/chartjs","core/log"],(function(e,t,n,a,l){return{init:function(s,o){async function i(e,t,a){var l=n.call([{methodname:"mod_otopo_get_my_evolution",args:{otopo:e,visual:t,item:a}}]);return await l[0]}function r(n){const s=document.getElementById("id_visual").value,r=parseInt(document.getElementById("id_item").value);i(parseInt(n),s,r).then((n=>(n.hascharts=n.charts.length>0,n.currentchart=n.currentchart.id?n.currentchart:null,n.chartitem=n.chartitem.id?n.chartitem:null,n.star=document.getElementById("evolution").dataset.star,t.renderForPromise("mod_otopo/evol",n).then((e=>{let l,{html:i,js:r}=e;if(t.replaceNodeContents("#evolution",i,r),"radar"==s)l={scale:{ticks:{min:0,max:n.max,stepSize:1}},scales:{r:{beginAtZero:!0}}};else{const e={ticks:{beginAtZero:!0,min:0,max:n.max,stepSize:1,callbacks:function(e){return 0===e?"":o+" "+e}}},t={display:!1};n.moodlePre4?(l={scales:{yAxes:[e]}},l.legend=t):(l={scales:{y:e}},l.plugins={},l.plugins.legend=t)}n.moodlePre4?l.tooltips={displayColors:!1,callbacks:{title:function(e,t){return t.fullLabels[e[0].index]},label:function(e,t){let n=t.datasets[e.datasetIndex].data[e.index]||"0";return n+=t.datasets[e.datasetIndex].labels[e.index]?" - "+t.datasets[e.datasetIndex].labels[e.index]:"",n}}}:(!l.plugins&&(l.plugins={}),l.plugins.tooltip={displayColors:!1,callbacks:{title:function(e){return e.length>0&&e[0].label?e[0].label:null},label:function(e){if(e){let t=e.formattedValue||"0";return t+=e.dataset.labels[e.dataIndex]?" - "+e.dataset.labels[e.dataIndex]:"",t}return null}}});const c=document.getElementById("currentChart");if(c&&n.currentchart){const e={type:s,data:n.currentchart,options:l};new a(c,e)}n.charts.forEach((function(e){const t=document.getElementById("chart"+e.id);t&&new a(t,{type:s,data:e,options:l})}));const d=document.getElementById("chartItem");if(d&&n.chartitem){n.moodlePre4?l.tooltips={displayColors:!1,callbacks:{label:function(e,t){var n=t.label||"";return n&&(n+=": "),(n+=t.datasets[e.datasetIndex].data[e.index]||"0")+(t.fullLabels[e.index]?" - "+t.fullLabels[e.index]:"")}}}:(!l.plugins&&(l.plugins={}),l.plugins.tooltip={displayColors:!1,callbacks:{title:function(e){return e.length>0&&e[0].label?e[0].label:null},label:function(e){if(e){let t=e.formattedValue||"0";return t+=": ",t+=e.dataset.label?e.dataset.label:"",t}return null}}});const e={type:s,data:n.chartitem,options:l};new a(d,e)}return!0})).catch(e.exception),!0))).catch(l.error)}document.getElementById("id_visual").onchange=function(){r(s)},document.getElementById("id_item").onchange=function(){r(s)},r(s);var c=0,d=0;window.onbeforeprint=function(){for(var e in a.instances)d=a.instances[e].canvas.parentNode.style.height,c=a.instances[e].canvas.parentNode.style.width,a.instances[e].canvas.parentNode.style.height="850px",a.instances[e].canvas.parentNode.style.width="850px",a.instances[e].resize()},window.addEventListener("afterprint",(function(){for(var e in a.instances)a.instances[e].canvas.parentNode.style.height=d,a.instances[e].canvas.parentNode.style.width=c,a.instances[e].resize()}))}}}));

//# sourceMappingURL=evolution.min.js.map